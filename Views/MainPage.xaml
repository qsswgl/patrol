<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:PatrolApp.ViewModels"
             xmlns:models="clr-namespace:PatrolApp.Models"
             x:Class="PatrolApp.Views.MainPage"
             x:DataType="viewmodels:MainViewModel"
             BackgroundColor="White">

    <Grid RowDefinitions="Auto,*" Padding="0">
        
        <!-- ç´«è‰²æ ‡é¢˜æ  -->
        <BoxView Grid.Row="0" 
                 Color="#6B46C1" 
                 HeightRequest="70"/>
        <Label Grid.Row="0"
               Text="å·¡æ›´æ‰“å¡"
               FontSize="24"
               FontAttributes="Bold"
               TextColor="White"
               VerticalOptions="Center"
               HorizontalOptions="Start"
               Margin="20,0"/>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="0" Padding="20">
                
                <!-- å½“å‰ä½ç½®å¡ç‰‡ -->
                <Frame BorderColor="#E2E8F0"
                       CornerRadius="12"
                       Padding="20"
                       Margin="0,0,0,15"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="å½“å‰ä½ç½®"
                               FontSize="14"
                               TextColor="#64748B"/>
                        <Label Text="{Binding CurrentLocation}"
                               FontSize="32"
                               FontAttributes="Bold"
                               TextColor="#6B46C1"/>
                        
                        <Label Text="å½“å‰æ—¶é—´"
                               FontSize="14"
                               TextColor="#64748B"
                               Margin="0,8,0,0"/>
                        <Label Text="{Binding CurrentTime}"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#1E293B"/>
                        
                        <HorizontalStackLayout Spacing="10" Margin="0,8,0,0">
                            <Label Text="NFCçŠ¶æ€:"
                                   FontSize="14"
                                   TextColor="#64748B"/>
                            <Label Text="{Binding IsNfcEnabled, Converter={StaticResource BoolToNfcStatusConverter}}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{Binding IsNfcEnabled, Converter={StaticResource BoolToColorConverter}}"/>
                        </HorizontalStackLayout>
                        
                        <HorizontalStackLayout Spacing="10" 
                                             IsVisible="{Binding LastNfcId, Converter={StaticResource StringToBoolConverter}}">
                            <Label Text="æœ€åŽè¯»å¡:"
                                   FontSize="14"
                                   TextColor="#64748B"/>
                            <Label Text="{Binding LastNfcId}"
                                   FontSize="14"
                                   TextColor="#1E293B"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- å¾…åŒæ­¥æç¤ºå¡ç‰‡ -->
                <Frame BorderColor="#FFA500"
                       BackgroundColor="#FFF7ED"
                       CornerRadius="12"
                       Padding="15"
                       Margin="0,0,0,15"
                       IsVisible="{Binding UnsyncedCount, Converter={StaticResource IntToBoolConverter}}">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Label Grid.Column="0"
                               Text="âš ï¸" 
                               FontSize="24"
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1"
                               Text="{Binding UnsyncedCount, StringFormat='æœ‰ {0} æ¡è®°å½•å¾…åŒæ­¥'}"
                               FontSize="16"
                               TextColor="#C2410C"
                               VerticalOptions="Center"
                               Margin="10,0"/>
                        <Button Grid.Column="2"
                                Text="ç«‹å³åŒæ­¥"
                                Command="{Binding SyncRecordsCommand}"
                                BackgroundColor="#FFA500"
                                TextColor="White"
                                FontSize="14"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="20,8"
                                VerticalOptions="Center"/>
                    </Grid>
                </Frame>

                <!-- æ‰“å¡è®°å½•æ ‡é¢˜ -->
                <Label Text="æ‰“å¡è®°å½•"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#1E293B"
                       Margin="0,0,0,12"/>

                <!-- æ‰“å¡è®°å½•åˆ—è¡¨ -->
                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Records}"
                                    Spacing="12">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:PatrolRecord">
                            <Frame BorderColor="#E2E8F0"
                                   CornerRadius="12"
                                   Padding="16"
                                   HasShadow="False">
                                <Grid RowDefinitions="Auto,Auto,Auto" 
                                      ColumnDefinitions="*,Auto">
                                    <!-- ä½ç½® -->
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Location}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="#1E293B"/>
                                    
                                    <!-- åŒæ­¥çŠ¶æ€ -->
                                    <Label Grid.Row="0" Grid.Column="1"
                                           Text="{Binding IsSynced, Converter={StaticResource BoolToSyncStatusConverter}}"
                                           FontSize="12"
                                           VerticalOptions="Center"
                                           TextColor="{Binding IsSynced, Converter={StaticResource BoolToSyncColorConverter}}"/>
                                    
                                    <!-- æ—¶é—´ -->
                                    <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding CheckInTime, StringFormat='{0:yyyy-MM-dd HH:mm:ss}'}"
                                           FontSize="14"
                                           TextColor="#64748B"
                                           Margin="0,4,0,0"/>
                                    
                                    <!-- NFC ID -->
                                    <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding NfcId, StringFormat='NFC: {0}'}"
                                           FontSize="12"
                                           TextColor="#94A3B8"
                                           Margin="0,4,0,0"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                    <BindableLayout.EmptyViewTemplate>
                        <DataTemplate>
                            <VerticalStackLayout VerticalOptions="Center"
                                               HorizontalOptions="Center"
                                               Padding="40"
                                               Margin="0,40,0,0">
                                <Label Text="ðŸ“±"
                                       FontSize="64"
                                       HorizontalOptions="Center"
                                       Opacity="0.3"/>
                                <Label Text="æš‚æ— æ‰“å¡è®°å½•"
                                       FontSize="16"
                                       TextColor="#94A3B8"
                                       HorizontalOptions="Center"
                                       Margin="0,12,0,0"/>
                                <Label Text="è¯·å°†æ‰‹æœºé è¿‘NFCæ ‡ç­¾è¿›è¡Œæ‰“å¡"
                                       FontSize="14"
                                       TextColor="#CBD5E1"
                                       HorizontalOptions="Center"
                                       Margin="0,4,0,0"/>
                            </VerticalStackLayout>
                        </DataTemplate>
                    </BindableLayout.EmptyViewTemplate>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

    </Grid>

</ContentPage>
